<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Healthcare Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="header-left">
                <div class="chat-header-icon">
                    üè•
                    <div class="status-indicator"></div>
                </div>
                <div class="chat-header-text">
                    <h1>AI Healthcare Assistant</h1>
                    <p>Online ‚Ä¢ Always here to help</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="action-btn" onclick="clearChat()">üóëÔ∏è</button>
            </div>
        </div>

        <!-- Messages Area -->
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <div class="welcome-icon">üëã</div>
                <h2>Welcome to AI Healthcare Assistant</h2>
                <p>I'm here to help you with health-related questions. Ask me anything!</p>
                
                <div class="suggestions">
                    <div class="suggestion-card" onclick="sendSuggestion('What are the symptoms of diabetes?')">
                        <div class="suggestion-icon diabetes">ü©∫</div>
                        <div class="suggestion-text">
                            <h3>Diabetes</h3>
                            <p>Symptoms & Info</p>
                        </div>
                    </div>
                    <div class="suggestion-card" onclick="sendSuggestion('How to manage high blood pressure?')">
                        <div class="suggestion-icon pressure">‚ù§Ô∏è</div>
                        <div class="suggestion-text">
                            <h3>Blood Pressure</h3>
                            <p>Management Tips</p>
                        </div>
                    </div>
                    <div class="suggestion-card" onclick="sendSuggestion('What causes fever?')">
                        <div class="suggestion-icon fever">üå°Ô∏è</div>
                        <div class="suggestion-text">
                            <h3>Fever</h3>
                            <p>Causes & Treatment</p>
                        </div>
                    </div>
                    <div class="suggestion-card" onclick="sendSuggestion('How to prevent asthma attacks?')">
                        <div class="suggestion-icon asthma">ü´Å</div>
                        <div class="suggestion-text">
                            <h3>Asthma</h3>
                            <p>Prevention Guide</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Container -->
        <div class="chat-input-container">
            <div class="quick-actions">
                <button class="quick-btn symptoms" onclick="sendSuggestion('What are common symptoms?')">üíä Symptoms</button>
                <button class="quick-btn treatment" onclick="sendSuggestion('What treatments are available?')">üè• Treatment</button>
                <button class="quick-btn prevention" onclick="sendSuggestion('How to prevent diseases?')">üõ°Ô∏è Prevention</button>
                <button class="quick-btn emergency" onclick="sendSuggestion('What should I do in an emergency?')">üö® Emergency</button>
            </div>
            
            <form id="chatForm">
                <div class="chat-input-wrapper">
                    <input 
                        type="text" 
                        id="messageInput" 
                        class="chat-input" 
                        placeholder="Ask me anything about health..."
                        autocomplete="off"
                        required
                    >
                    <button type="submit" class="send-button">
                        <span class="send-icon">‚û§</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Prevent form default submission
        document.getElementById('chatForm').addEventListener('submit', function(e) {
            e.preventDefault();
            sendMessage();
        });

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Hide welcome message
            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }
            
            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Create FormData
            const formData = new FormData();
            formData.append('msg', message);
            
            // Send to backend using fetch
            fetch('/get', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(data => {
                removeTypingIndicator();
                addMessage(data, 'bot');
            })
            .catch(error => {
                console.error('Error:', error);
                removeTypingIndicator();
                addMessage('Sorry, I encountered an error. Please try again.', 'bot');
            });
        }
        
        function sendSuggestion(text) {
            document.getElementById('messageInput').value = text;
            sendMessage();
        }
        
        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'bot') {
                messageDiv.innerHTML = `
                    <div class="message-avatar bot-avatar">ü§ñ</div>
                    <div class="message-content">${escapeHtml(text)}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">${escapeHtml(text)}</div>
                    <div class="message-avatar user-avatar">üë§</div>
                `;
            }
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar bot-avatar">ü§ñ</div>
                <div class="typing-indicator active">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        function clearChat() {
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.innerHTML = `
                <div class="welcome-message">
                    <div class="welcome-icon">üëã</div>
                    <h2>Welcome to AI Healthcare Assistant</h2>
                    <p>I'm here to help you with health-related questions. Ask me anything!</p>
                    
                    <div class="suggestions">
                        <div class="suggestion-card" onclick="sendSuggestion('What are the symptoms of diabetes?')">
                            <div class="suggestion-icon diabetes">ü©∫</div>
                            <div class="suggestion-text">
                                <h3>Diabetes</h3>
                                <p>Symptoms & Info</p>
                            </div>
                        </div>
                        <div class="suggestion-card" onclick="sendSuggestion('How to manage high blood pressure?')">
                            <div class="suggestion-icon pressure">‚ù§Ô∏è</div>
                            <div class="suggestion-text">
                                <h3>Blood Pressure</h3>
                                <p>Management Tips</p>
                            </div>
                        </div>
                        <div class="suggestion-card" onclick="sendSuggestion('What causes fever?')">
                            <div class="suggestion-icon fever">üå°Ô∏è</div>
                            <div class="suggestion-text">
                                <h3>Fever</h3>
                                <p>Causes & Treatment</p>
                            </div>
                        </div>
                        <div class="suggestion-card" onclick="sendSuggestion('How to prevent asthma attacks?')">
                            <div class="suggestion-icon asthma">ü´Å</div>
                            <div class="suggestion-text">
                                <h3>Asthma</h3>
                                <p>Prevention Guide</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
    </script>
</body>
</html>